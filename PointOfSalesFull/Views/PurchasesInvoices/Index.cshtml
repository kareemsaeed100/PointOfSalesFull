

<br /><br />

<div class="panel panel-default">
    @*عرض الفواتير*@
    <div class="panel-heading">
        <div class="row">
            <h2 align="center" class="panel-title ">
                <strong style="text-align:center;color:red">فاتورة مشتريات</strong>
            </h2>

            <button style="margin-right:10px" class="btn btn-primary pull-right" onclick="addNewOrder()">ْْانشاء فاتورة</button>


            <div style="align-content:center">
                <input style="align-content:center" type="text" id="myInput" class="form-control" onkeyup="Search()" placeholder="ابحث برقم الفاتورة..">
                @*<button style="margin-right:10px" class="btn btn-primary pull-right" onclick="Search()">ْْبحث</button>*@
            </div>


        </div>
        @*show max invoice*@
        <div id="showmax" style="display:none" class="panel-body">
            <table class="table table-striped table-responsive">
                <tbody>
                    <tr id="invoichead"></tr>
                    <tr>
                        <td colspan="5">
                            <table class="table table-bordered">
                                <tbody id="invoicDetailes"></tbody>
                            </table>
                            <div id="totalbody"> </div>

                        </td>
                    </tr>
                </tbody>
            </table>
        </div>



    </div>
    @*تعديل الفواتير*@
    <div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                    <h4 class="modal-title custom_align" id="Heading">تعديل الصنف</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <input type="hidden" id="Order_D_key" name="Order_D_key" placeholder="Product Name" class="form-control" />
                        <label class="control-label col-md-2">
                            اسم الصنف
                        </label>
                        <input type="text" id="productNameEdit" name="Product_ID" readonly placeholder="Product Name" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">
                            سعر الوحدة
                        </label>
                        <input type="number" id="priceEdit" name="Price" placeholder="0" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">
                            الكمية
                        </label>
                        <input type="number" id="quintityEdit" name="Quintity" placeholder="0" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">
                            السعر
                        </label>
                        <input type="number" id="amountEdit" readonly name="Amount" placeholder="0" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">
                            الخصم
                        </label>
                        <input type="number" id="discountEdit" name="discount" placeholder="0" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">
                            الضريبة
                        </label>
                        <input type="number" id="taxEdit" readonly name="Tax" placeholder="0" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">
                            الاحمالى
                        </label>
                        <input type="number" id="totalEdit" readonly name="Total" placeholder="0" class="form-control" />
                    </div>

                </div>
                <div class="modal-footer ">
                    <button type="button" onclick="SaveUpdateProduct()" class="btn btn-warning btn-lg" style="width: 100%;"><span class="glyphicon glyphicon-ok-sign"></span> حفظ</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    @*انشاء فاتورة جديدة*@

    <div class="modal fade" id="newOrderModal">
        <div class="modal-dialog modal-lg" style=" width 900px !important;">
            <div class="modal-content">
                <div class="modal-header">
                    <a href="#" class="close" data-dismiss="modal">&times;</a>
                    <h4 style="color:red; font:bold" align="center">أضافة فاتورة جديدة</h4>
                </div>
                <form id="NewOrderForm">
                    <div class="modal-body">
                        <div class="form-horizontal">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-4">
                                        تاريخ الفاتورة
                                    </label>
                                    <div class="col-md-6">

                                        <input dir="rtl" placeholder="اختر التاريخ" name="vch_DatG" type="date" id="date-picker-example" class="form-control datepicker">

                                    </div>

                                </div>
                            </div>
                            <hr />
                            <div class="col-md-6">
                                @*<h4 style="color:#ff6347"><b>البائع</b> </h4>*@
                                <input type="hidden" id="Saller_ID" />
                                <div class="form-group">
                                    <label class="control-label col-md-4">
                                        اسم المستلم
                                    </label>
                                    <div class="col-md-6">

                                        @Html.DropDownList("Saller_ID", null, "اختر اسم المستلم", htmlAttributes: new { @id = "sallername", @class = "DropDown col-md-10" })

                                    </div>

                                </div>
                            </div>
                            <hr />
                            <div class="col-md-6">
                                @*<h4 style="color:#ff6347"><b>البائع</b> </h4>*@
                                <input type="hidden" id="Saller_ID" />
                                <div class="form-group">
                                    <label class="control-label col-md-4">
                                        اسم المورد
                                    </label>
                                    <div class="col-md-6">

                                        @Html.DropDownList("Supplier_ID", null, "اختر اسم المورد", htmlAttributes: new { @id = "name", @class = "DropDown col-md-10" })

                                    </div>

                                </div>
                            </div>
                            <hr />
                            <div class="col-md-6">
                                @*<h4 style="color:#ff6347"><b>الفرع</b> </h4>*@
                                <input type="hidden" id="Branch_ID" />
                                <div class="form-group">
                                    <label class="control-label col-md-4">
                                        اسم الفرع
                                    </label>
                                    <div class="col-md-6">
                                        @Html.DropDownList("Branch", null, "اختر اسم الفرع", htmlAttributes: new { @id = "BranchName", @class = "DropDown col-md-10" })
                                </div>
                            </div>
                        </div>

                        @*branch and pay mode Details*@
                        @*Order Details*@
                        <h4 style="margin-top:10px;color:#ff6347"><b>اضافة الاصناف</b></h4>
                        <hr />
                        <div class="form-horizontal">
                            <input type="hidden" id="OrderId" />
                            <div class="form-group">
                                <label class="control-label col-md-2">
                                    اسم الصنف
                                </label>
                                <div class="col-md-2">
                                    @Html.DropDownList("product", null, "اختر اسم الصنف", htmlAttributes: new { @id = "productName", @class = "DropDown", })
                                    @*<input type="text" id="productName" name="Product_Name" placeholder="Product Name" class="form-control" />*@
                                </div>
                                <label class="control-label col-md-2">
                                    سعر الوحدة
                                </label>
                                <div class="col-md-2">
                                    <input type="number" id="price" value="0" name="Price" placeholder="0" class="form-control" />
                                </div>
                                <label class="control-label col-md-2">
                                    الكمية
                                </label>
                                <div class="col-md-2">
                                    <input type="number" id="quintity" value="0" name="Quintity" placeholder="0" class="form-control" />
                                </div>
                                <label class="control-label col-md-2">
                                    السعر
                                </label>
                                <div class="col-md-2">
                                    <input type="number" id="amount" value="0" readonly name="Amount" placeholder="0" class="form-control" />
                                </div>
                                <label class="control-label col-md-2">
                                    الخصم
                                </label>
                                <div class="col-md-2">
                                    <input type="number" id="discount" value="0" name="discount" placeholder="0" class="form-control" />
                                </div>
                                <label class="control-label col-md-2">
                                    الضريبة
                                </label>
                                <div class="col-md-2">
                                    <input type="number" id="tax" value="0" readonly name="Tax" placeholder="0" class="form-control" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">
                                    الاجمالى
                                </label>
                                <div class="col-md-4">
                                    <input type="number" id="total" value="0" readonly name="Total" placeholder="0" class="form-control" />
                                </div>
                                <div class="col-md-2 col-lg-offset-4">
                                    <a id="addToList" class="btn btn-primary">اضافة الى الفاتورة</a>
                                </div>
                            </div>

                            <table id="detailsTable" class="table">
                                <thead>
                                    <tr>
                                        <th style="width:25%">الصنف</th>
                                        <th style="width:10%">الكمية</th>
                                        <th style="width:15%">سعر الوحدة</th>
                                        <th style="width:15%">السعر</th>
                                        <th style="width:10%">الخصم</th>
                                        <th style="width:10%">الضريبة</th>
                                        <th style="width:25%">الاجمالى</th>
                                        <th style="width:10%"></th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                      </div>
                    <div class="modal-footer">
                        <label id="" style="color:red" class="control-label col-md-4">
                            <b style="font:bold" class="btn-group">المطلوب سداده</b>
                        </label>
                        <input style="color:red" readonly class="form-control col-md-4" id="wantedVal" type="text" value="0" />
                        <hr />
                        <hr />
                        @*payment Details*@
                        <div class="col-md-6">
                            @*<h4 style="color:#ff6347"><b>اسلوب الدفع</b> </h4>*@
                            <input type="hidden" id="Pay_ID1" />
                            <div class="form-group">
                                <label class="control-label col-md-4">
                                    اسلوب الدفع1
                                </label>
                                <div class="col-md-6">

                                    @Html.DropDownList("PayMode", null, htmlAttributes: new { @id = "PayName1", @class = "DropDown col-md-10" })
                                    <label class="control-label col-md-4">
                                        القيمة
                                    </label>
                                    <input type="number" id="Pay1Val" value="0" name="Pay1Val" placeholder="0" class="form-control col-md-10" />
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label col-md-4">
                                    اسلوب الدفع2
                                </label>
                                <div class="col-md-6">
                                    @Html.DropDownList("PayMode", null, htmlAttributes: new { @id = "PayName2", @class = "DropDown col-md-10" })
                                    <label class="control-label col-md-4">
                                        القيمة
                                    </label>
                                    <input type="number" id="Pay2Val" value="0" name="Pay2Val" placeholder="0" class="form-control col-md-10" />
                                </div>
                            </div>
                        </div>
                          <button type="reset" class="btn btn-default" data-dismiss="modal">خروج</button>
                        <button id="saveOrder" type="submit" class="btn btn-danger">حفظ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    @*حذف المنتج*@
    <div class="modal fade" id="DeleteConfirmation">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <a href="#" class="close" data-dismiss="modal">&times;</a>
                    <h4>حذف المنتج من الفاتورة</h4>
                </div>
                <div class="modal-body">
                    <h4>هل انت متأكد من حذف المنتج.</h4>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-primary" data-dismiss="modal" id="r">الغاء</a>
                    <a href="#" class="btn btn-danger" onclick="ConfirmDelete()">تأكيد</a>
                </div>
            </div>
        </div>
    </div>
    @*حذف الفاتورة*@
    <div class="modal fade" id="DeleteConfirmationInvoic">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <a href="#" class="close" data-dismiss="modal">&times;</a>
                    <h4>حذف  الفاتورة</h4>
                </div>
                <div class="modal-body">
                    <h4>هل انت متأكد من حذف الفاتورة.</h4>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-primary" data-dismiss="modal" id="r">الغاء</a>
                    <a href="#" class="btn btn-danger" onclick="ConfirmDeleteInvoice()">تأكيد</a>
                </div>
            </div>
        </div>
    </div>
    <div id="empity" class="panel-body">
        <h3 style="color:red;">فارغ!</h3>
    </div>

</div>
@section scripts{
    @*<script src="~/Scripts/jquery-1.10.2.js"></script>
        <script src="~/Scripts/jquery-1.10.2.min.js"></script>*@
    <script>
        getmax1();
        getmax2();
        function Search()
        {
            getmax1();
            getmax2();
        }

        var o_d_k;
        var o_id;
        // delete order
        function DeleteOrder(id) {
            o_id = id;
            $("#DeleteConfirmationInvoic").modal("show");


        }
        var ConfirmDeleteInvoice = function () {
            var id = o_id;
            $.ajax({
                url: "/PurchasesInvoices/DeleteOrder?id=" + id,
                type: "post",
                datatype: JSON,
                success: function (data) {
                    if (data.StatUs == 1) {
                        $("#DeleteConfirmationInvoic").modal("hide");
                        location.reload();
                    }
                    else
                        alert("لم تتم عملية الحذف");
                },
                error: function (data) {
                    alert(text(data.Message));
                }
            });


        }
        //delete product
        function DeleteProduct(Order_Det_Key) {
            o_d_k = Order_Det_Key;
            $("#DeleteConfirmation").modal("show");

        }
        var ConfirmDelete = function () {
            var Order_Det_Key = o_d_k;
            $.ajax({
                url: "/PurchasesInvoices/DeleteProduct?Order_Det_Key=" + Order_Det_Key,
                type: "post",
                datatype: JSON,
                success: function (data) {
                    if (data.StatUs == 1) {
                        $("#DeleteConfirmation").modal("hide");
                        location.reload();
                    }
                    else
                        alert("لم تتم عملية الحذف");
                },
                error: function (data) {
                    alert(text(data.Message));
                }
            });


        }

        function GetNext()
        {
            alert($("#invoicenum").val());
        }

        function GetPrefex() {
            alert($("#invoicenum").val());
        }


        //UpdateProduct
        function UpdateProduct(Order_Det_Key) {

            $.ajax({
                url: "/PurchasesInvoices/UpdateProduct?Order_Det_Key=" + Order_Det_Key,
                type: "post",
                datatype: JSON,
                success: function (data) {
                    if (data.StatUs == 1) {
                        alert("تمت عملية التعديل بنجاح");
                        location.reload();
                    }
                    else
                        alert("لم تتم عملية التعديل");
                },
                error: function (data) {
                    alert(text(data.Message));
                }
            });
        }

        function EditProduct(Order_Det_Key) {
            $.ajax({
                url: "/PurchasesInvoices/GetOrderDetailesByID?Order_Det_Key=" + Order_Det_Key,
                type: "Get",
                format: "Json",
                success: function (data) {
                    $("#productNameEdit").val(data.Product_Name);
                    $("#Order_D_key").val(data.Order_D_key);
                    $("#quintityEdit").val(data.Quintity);
                    $("#priceEdit").val(data.Price);
                    $("#amountEdit").val(data.Amount);
                    $("#discountEdit").val(data.discount);
                    $("#taxEdit").val(data.Tax);
                    $("#totalEdit").val(data.Total);

                },
                error: function () {
                    alert("error");
                }

            });
        }

        function SaveUpdateProduct() {

            var Order_Det_Key = $("#Order_D_key").val();
            var Quintity = $("#quintityEdit").val();
            var Price = $("#priceEdit").val();
            var Amount = $("#amountEdit").val();
            var discount = $("#discountEdit").val();
            var Tax = $("#taxEdit").val();
            var Total = $("#totalEdit").val();
            if ($.trim($("#priceEdit").val()) == "" || $.trim($("#quintityEdit").val()) == "" || $.trim($("#amountEdit").val()) == "" || $.trim($("#discountEdit").val()) == "" || $.trim($("#taxEdit").val()) == "" || $.trim($("#totalEdit").val()) == "") return;
            if ($.trim($("#priceEdit").val()) <= 0 || $.trim($("#quintityEdit").val()) <= 0 || $.trim($("#discountEdit").val()) < 0) {
                alert("ادخل قيم صحيحة");
                return;
            }
            //if ($.trim($("#discountEdit").val()) > $.trim($("#amountEdit").val())) {
            //    alert("قيمة الخصم اكبر من الاجمالى");
            //    return;
            //}
            var data = { Product_Name: "", Order_D_key: Order_Det_Key, Quintity: Quintity, Price: Price, Amount: Amount, discount: discount, Tax: Tax, Total: Total }

            $.ajax({
                url: "/PurchasesInvoices/SaveUpdateProduct?Order_Det_Key=" + Order_Det_Key,
                type: "post",
                datatype: JSON,
                data: data,
                success: function (data) {
                    if (data.StatUs == 1) {
                        alert(data.Message);
                        location.reload();
                    }
                    else
                        alert(data.Message);
                },
                error: function (data) {
                    alert(data.Message);
                }


            });

        }

        function UpdateOrder() {
            alert("UpdateOrder");
        }
//get max invoice
        function getmax1() {
            var order_num = $("#myInput").val();

            if (order_num > 0) {
               // location.reload();
                $.get("/PurchasesInvoices/GetordersHeadSearch?order_num=" + order_num, null, DataBind)
                $("#invoichead").empty();
            }
            else
                {
                $.get("/PurchasesInvoices/Getorders", null, DataBind);
                $("#invoichead").empty();
            }
            function DataBind(OrderList1) {
                var indexBody = $("#invoichead");
                if (OrderList1.length > 0)
                {

                    for (var i = 0; i < OrderList1.length; i++) {
                        var Data = "<td>اسم المورد :" + OrderList1[i].First_Name + "</td>" +
                                                 "<td>اسم المستلم :" + OrderList1[i].Saler_Name + "</td>" +
                                                  "<td id='invoicenum'>رقم الفاتورة :" + OrderList1[i].Order_Id + "</td>" +
                                                   "<td id='invoicenum'>اسم الفرع :" + OrderList1[i].BranchName + "</td>" +
                                                 "<td>تاريخ الفاتورة :" + OrderList1[i].Order_Date + "</td>";
                        indexBody.append(Data);

                    }
                    $("#showmax").show();
                    $("#empity").hide();
                }
                else
                    $("#empity").show();

            }
        }
        function getmax2() {
            var totalBill = 0.0;
            var totalbody = $("#totalbody");
            var order_Id;

            var order_num = $("#myInput").val();
            if (order_num > null) {
                $.get("/PurchasesInvoices/GetorderDetailesSearch?order_num=" + order_num, null, DataBind2)
                $("#invoicDetailes").empty();
                $("#totalbody").empty();
            }
            else
                {
                $.get("/PurchasesInvoices/GetorderDetailess", null, DataBind2)
                $("#invoicDetailes").empty();
                $("#totalbody").empty();
                //$("#totalbody").append("<button onclick='GetNext()' class='btn btn-primary pull-right' style='margin-right:100px;'> <strong>الفاتورة التالية</strong></button>" +
                //                  "<button onclick='GetPrefex()' class='btn btn-primary pull-right' style='margin-right:100px;'> <strong>الفاتورة السابقة</strong></button>");

            }
            function DataBind2(OrderList2) {
                var indexBody = $("#invoicDetailes");
                if (OrderList2.length > 0) {
                    indexBody.append("<tr><th>الصنف</th><th>الكمية</th><th>سعر الوحدة</th><th>السعر</th><th>الخصم</th><th>الضريبة</th><th>الاجمالى</th></tr>");
                    for (var i = 0; i < OrderList2.length; i++) {
                        totalBill = totalBill + OrderList2[i].Total;
                        var Data = "<tr><td style='display:none'>" + OrderList2[i].Order_D_key + "</td>" +
                                                                                     "<td>" + OrderList2[i].Product_Name + "</td>" +
                                                                                      "<td>" + OrderList2[i].Quintity + "</td>" +
                                                                                      "<td>" + OrderList2[i].Price + "</td>" +
                                                                                      "<td>" + OrderList2[i].Amount + "</td>" +
                                                                                      "<td>" + OrderList2[i].discount + "</td>" +
                                                                                      "<td>" + OrderList2[i].Tax + "</td>" +
                                                                                      "<td>" + OrderList2[i].Total + "</td></tr>";

                        order_Id = OrderList2[i].Order_Id;
                        indexBody.append(Data);


                    }
                    totalbody.append("<span class='pull-right' style='margin-right:100px;'><strong>اجمالى الفاتورة :  </strong> " + totalBill + "</span>" +
                                  "<button onclick='DeleteOrder(" + order_Id + ")' class='pull-right btn btn-danger pull-right' style='margin-right:100px;'> <strong>حذف   الفاتورة   </strong></button><br/><br/><br/>" +
                                     "<a id='reportpdf' href='#' onclick='Exatractreport()' class='report'title='تحميل'  href=''></a>" +
                                      "<a id='reportexel' class='report' href='#' title='تحميل' onclick='Exatractreport(Excel)'></a>" +

                                       "<a id='reportWord' class='report' href='#' title='تحميل' onclick='Exatractreport(Word)'></a>" +

                                       "<a id='reportImage'  class='report' href='#' title='تحميل' onclick='Exatractreport(Image)'></a>");
                }
            }
        }
 //get serach invoice
        function getSearchHead(order_num) {
            $.get("/PurchasesInvoices/GetordersHeadSearch?order_num=" + order_num, null, DataBind)
            function DataBind(OrderList1) {
                var indexBody = $("#invoichead");
                if (OrderList1.length > 0) {
                    $("#showmax").show();
                    $("#empity").hide();
                    for (var i = 0; i < OrderList1.length; i++) {
                        var Data = "<td>اسم العميل :" + OrderList1[i].First_Name + "</td>" +
                        "<td>العنوان :" + OrderList1[i].Email + "</td>" +
                         "<td>رقم الفاتورة :" + OrderList1[i].Order_Id + "</td>" +
                        "<td>تاريخ الفاتورة :" + OrderList1[i].Order_Date + "</td>";
                        indexBody.append(Data);

                    }
                }
                else
                    $("#empity").show();

            }
        }
        function getSearchDetailes(order_num) {
            var totalBill = 0.0;
            var totalbody = $("#totalbody");
            var order_Id;
            $.get("/PurchasesInvoices/GetorderDetailesSearch?order_num=" + order_num, null, DataBind2)
            function DataBind2(OrderList2) {
                if (OrderList2.length > 0) {
                    var indexBody = $("#invoicDetailes");

                    for (var i = 0; i < OrderList2.length; i++) {
                        totalBill = totalBill + OrderList2[i].Total;
                        var Data = "<tr><td style='display:none'>" + OrderList2[i].Order_D_key + "</td>" +
                                                                                     "<td>" + OrderList2[i].Product_Name + "</td>" +
                                                                                      "<td>" + OrderList2[i].Quintity + "</td>" +
                                                                                      "<td>" + OrderList2[i].Price + "</td>" +
                                                                                      "<td>" + OrderList2[i].Amount + "</td>" +
                                                                                      "<td>" + OrderList2[i].discount + "</td>" +
                                                                                      "<td>" + OrderList2[i].Tax + "</td>" +
                                                                                      "<td>" + OrderList2[i].Total + "</td>" +
                                                                                     "<td><p data-placement='top' data-toggle='tooltip' title='تعديل'><button onclick='EditProduct(" + OrderList2[i].Order_D_key + ")' class='btn btn-primary btn-xs' data-title='Edit' data-toggle='modal' data-target='#edit'><span class='glyphicon glyphicon-pencil'></span></button></p></td>" +
                                                                                     "<td><p data-placement='top' data-toggle='tooltip' title='حذف'><button onclick='DeleteProduct(" + OrderList2[i].Order_D_key + ")' class='btn btn-danger btn-xs' data-title='Delete' data-toggle='modal' data-target='#delete'><span class='glyphicon glyphicon-trash'></span></button></p></td></tr>";

                        order_Id = OrderList2[i].Order_Id;
                        indexBody.append(Data);


                    }
                    totalbody.append("<span class='pull-right' style='margin-right:100px;'><strong>اجمالى الفاتورة :  </strong> " + totalBill + "</span>" +
                                  "<button onclick='DeleteOrder(" + order_Id + ")' class='pull-right btn btn-danger pull-right' style='margin-right:100px;'> <strong>حذف   الفاتورة   </strong></button>");
                }
                }
        }


        $("#quintity,#price,#discount,#quintityEdit,#priceEdit,#discountEdit").on('change keyup', function (event) {
            if (event.shiftKey) {
                event.preventDefault();
            }

            if (event.keyCode == 46 || event.keyCode == 8) {
            }
            else {
                if (event.keyCode < 95) {
                    if (event.keyCode < 48 || event.keyCode > 57) {
                        event.preventDefault();
                    }
                }
                else {
                    if (event.keyCode < 96 || event.keyCode > 105) {
                        event.preventDefault();
                    }
                }
            }
        });

        var x;
        //Show Modal.
        function addNewOrder() {
            //$("#name").val("اختر اسم العميل");
            $("#Email").val("");
            $("#newOrderModal").modal();
        }

        //Add Multiple Order.
        $("#addToList").click(function (e) {
            var wantedVal = 0;
            e.preventDefault();

            if ($.trim($("#productName").val()) == "" || $.trim($("#price").val()) == "" || $.trim($("#quintity").val()) == "" || $.trim($("#amount").val()) == "" || $.trim($("#discount").val()) == "" || $.trim($("#tax").val()) == "" || $.trim($("#price").val()) == "" || $.trim($("#total").val()) == "") return;
            if ($.trim($("#price").val()) <= 0 || $.trim($("#quintity").val()) <= 0 || $.trim($("#discount").val()) < 0) {
                // $("#errordiv").append("<strong class='text-center'>ادخل قيم صحيحة</strong>");
                alert("ادخل قيم صحيحة");

                return;
            }
            x = $("#productName").val();
            var productName = $("#productName").val(),
                price = $("#price").val(),
                quintity = $("#quintity").val(),
                   amount = $("#amount").val(),
                discount = $("#discount").val(),
                   tax = $("#tax").val(),
                total = $("#total").val(),
                detailsTableBody = $("#detailsTable tbody");

            var productItem = '<tr><td>' + productName + '</td><td>' + quintity + '</td><td>' + price + '</td><td>' + amount + '</td><td>' + discount + '</td><td>' + tax + '</td><td>' + total + '</td><td><a data-itemId="0" href="#" class="deleteItem">حذف</a></td></tr>';
            detailsTableBody.append(productItem);
            wantedVal = parseFloat(wantedVal) + parseFloat($("#total").val());
            var old = parseFloat($("#wantedVal").val());
            $("#wantedVal").val(wantedVal + old);
            clearItem();
        });
        //After Add A New Order In The List, Clear Clean The Form For Add More Order.
        function clearItem() {
            $("#productName").val("اختر اسم الصنف");
            $("#price").val(0);
            $("#quintity").val(0);
            $("#amount").val(0);
            $("#discount").val(0);
            $("#tax").val(0);
            $("#total").val(0);
        }
        // After Add A New Order In The List, If You Want, You Can Remove It.
        $(document).on('click', 'a.deleteItem', function (e) {
            e.preventDefault();
            var wantedVal = 0;
            var $self = $(this);
            if ($(this).attr('data-itemId') == "0") {
                $(this).parents('tr').css("background-color", "#ff6347").fadeOut(800, function () {
                    $(this).remove();
                    $.each($("#detailsTable tbody tr"), function () {
                        wantedVal = wantedVal + parseFloat($(this).find('td:eq(6)').html());
                    });
                    $("#wantedVal").val(wantedVal);
                });
            }
        });
        //After Click Save Button Pass All Data View To Controller For Save Database
        function saveOrder(data) {
            return $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                type: 'POST',
                url: "/PurchasesInvoices/SaveOrder",
                data: data,
                success: function (result) {
                    alert(result);
                    location.reload();
                },
                error: function () {
                    alert("Error!")
                }
            });
        }
        //Collect Multiple Order List For Pass To Controller
        $("#saveOrder").click(function (e) {
            e.preventDefault();
            var orderArr = [];
            orderArr.length = 0;
            var TotalPrice = 0;
            var TotalPaid = 0;
            var pay1Val = 0;
            var pay2Val = 0;
            if ($("#Pay1Val").val() == "") {
                pay1Val = 0;
            }
            else {
                pay1Val = parseFloat($("#Pay1Val").val());
            }
            if ($("#Pay2Val").val() == "") {
                pay2Val = 0;
            }
            else {
                pay2Val = parseFloat($("#Pay2Val").val());
            }
            $.each($("#detailsTable tbody tr"), function () {
                orderArr.push({
                    productName: $(this).find('td:eq(0)').html(),
                    quintity: $(this).find('td:eq(1)').html(),
                    price: $(this).find('td:eq(2)').html(),
                    amount: $(this).find('td:eq(3)').html(),
                    discount: $(this).find('td:eq(4)').html(),
                    tax: $(this).find('td:eq(5)').html(),
                    total: $(this).find('td:eq(6)').html()

                });
                TotalPrice = TotalPrice + parseFloat($(this).find('td:eq(6)').html());
            });
            TotalPaid = parseFloat(pay1Val) + parseFloat(pay2Val);
            //if (parseFloat(TotalPaid) != parseFloat(TotalPrice)) {
            //    alert("قيمة المدفوع لا تساوى قيمة المستحق");
            //    return;

            //}

            var data = JSON.stringify({
                name: $("#name").val(),
                SupplierId: $("#name").val(),
                Saller_ID: $("#sallername").val(),
                Pay_ID1: $("#PayName1").val(),
                Pay_ID2: $("#PayName2").val(),
                Pay1Val: pay1Val,
                Pay2Val: pay2Val,
                Branch_ID: $("#BranchName").val(),
                OrderDate: $("#date-picker-example").val(),
                X: x,
                order: orderArr

            });

            $.when(saveOrder(data)).then(function (response) {
                console.log(response);
            }).fail(function (err) {
                console.log(err);
            });
        });


        //quantity
        $('#quintity,#price').on('change keyup', function () {
            var price = $("#price").val();
            var quintity = $("#quintity").val();
            var amount = quintity * price;
            var discount = $("#discount").val();

            if (amount >= 0) {
                $("#amount").val(amount);
                var tax = (amount - discount) * 0.05;
                if (tax >= 0) {
                    $("#tax").val(tax);
                    var total = amount - discount + tax;
                    $("#total").val(total);
                }
            }

        });
        //tax
        $('#discount').on('change keyup', function () {
            var amount = $("#amount").val();
            var discount = $("#discount").val();
            var tax = (amount - discount) * 0.05;
            if (tax >= 0) {
                $("#tax").val(tax);
                var total = amount - discount + tax;
                $("#total").val(total);
            }

        });
        //
        //positive number
        $('#price').on('change keyup', function () {
            if ($('#price').val() != "") {
                if ($('#Field').val() < 0) {
                    alert("insert positve");
                }
            }
        });




        if ($('#price,#discount,#quintity,#priceEdit,#discountEdit,#quintityEdit').val() != "") {
            if ($('#Field').val().match('^(0|[1-9][0-9]*)$')) {
                alert("Field must be numeric");
                success = false;
            }
        }
        //////////////////////////////////////////////////////////////////////////
        //order update
        //quantity
        $('#quintityEdit,#priceEdit').on('change keyup', function () {

            var price = $("#priceEdit").val();
            var quintity = $("#quintityEdit").val();
            var amount = quintity * price;
            var discount = $("#discountEdit").val();

            if (amount >= 0) {
                $("#amountEdit").val(amount);
                var tax = (amount - discount) * 0.05;
                if (tax >= 0) {
                    $("#taxEdit").val(tax);
                    var total = amount - discount + tax;
                    $("#totalEdit").val(total);
                }
            }

        });
        //tax
        $('#discountEdit').on('change keyup', function () {
            var amount = $("#amountEdit").val();
            var discount = $("#discountEdit").val();
            var tax = (amount - discount) * 0.05;
            if (tax >= 0) {
                $("#taxEdit").val(tax);
                var total = amount - discount + tax;
                $("#totalEdit").val(total);
            }

        });
        //
        function Exatractreport() {
            var Sales = $("#myInput").val();
            if (Sales > 0) {
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("ExportReportSearch", "PurchasesInvoices")',
                    dataType: 'html',
                    data: ({
                        Pure_num: Sales
                    })
                });
            }
            else {
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("ExportReportMax", "PurchasesInvoices")',
                    dataType: 'html'
                });
            }


        }

        getDate();
        function getDate() {
            var today = new Date();

            document.getElementById("date-picker-example").value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);
        }





    </script>


}